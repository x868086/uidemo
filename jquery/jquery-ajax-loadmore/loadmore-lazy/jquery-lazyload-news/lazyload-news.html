<!DOCTYPE html>
<html lang="en">
    <head>
        <title></title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <style type="text/css">
        div,p,h5,ul,li,img,a{
            margin:0px;
            padding:0px;
        }

        ul,li{
            list-style:none;
        }

        a{
            text-decoration:none;
            color:black;
        }

        .clearfix:after{
            content:"";
            display:block;
            clear:both;
        }

        #container{
            width:600px;
            margin:0 auto;
            border:1px solid green;
        }

        .newsview{
            margin-top:20px;
        }

        .newsview img{
            width:60px;
            height:60px;
            float:left;
        }

        .newsview h5,p{
            margin-left:10px;
            margin-top:5px;
            float:left;
        }

        p{
            color:#aaa;
            font-size:14px;
        }
        </style>
        <script type="text/javascript" src="http://apps.bdimg.com/libs/jquery/1.9.1/jquery.js">
        </script>
    </head>
    <body>
    <div id="container">
            <ul>
                <!-- <li class="newsview">
                    <a href="http://xw.qq.com/mil/20160830028700/MIL2016083002870002" class="clearfix">
                        <img src="http://inews.gtimg.com/newsapp_ls/0/531644649_150120/0" alt="">
                        <h5>西媒臆断老挝“弃华投美” 认为现政府更亲越南</h5>
                        <p>西媒臆断老挝“弃华投美” 认为现政府更亲越南</p>
                    </a>
                </li> -->
                <p class="load-flag">加载更多</p>
            </ul>
    </div>
    <script>
        /*tips思路：1.设置一个加载更多的元素放在li的最下方，当这个元素scroll时或者初始状态时出现在window视窗可视范围内时执行ajax请求
        2.ajax请求，发送页数，后台返回固定个数的新闻清单+数据状态码，状态码标识数据返回是否出错
        3.前台获取到后台传来的数据拼装成DOM元素插入到ul底部
        4.当返回数据为空时在ul底部插入p标签显示数据加载完了
        5.用visibility:hidden隐藏加载更多标签，因为用display:none元素会脱离文档流始终处于window可视窗口*/
    $(window).ready(function(){
        var $node=$(".load-flag")

        getNews();

        function getNews(){
            if(isShow($node)){
                $.ajax({
                    url:"/getmore",
                    method:"GET",
                    data:{"pageIndex":index},
                    dataType:"json"}).done(function(res){
                        renderHtml(res)
                }).fail(function(){
                    alert("数据请求错误")
                })
            }
        }
        

        function isShow($node){
            var scrollY=$(window).scrollTop(),
                windowHeight=$(window).height(),
                offsetY=$node.offset().top
            if(offsetY < scrollY + windowHeight && offsetY > scrollY){
                return true;
            }else{
                return false;
            }
        }

        function renderHtml(res){
            console.log(res)
        }
    })
    </script>
    </body>
</html>